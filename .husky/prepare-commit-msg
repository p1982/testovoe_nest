#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Get current branch name
branch=$(git branch --show-current)

# Add branch prefix to commit message if not already present
if ! grep -q "^$branch:" "$1"; then
    # Only add branch prefix for feature branches (not main/develop)
    if [[ "$branch" != "main" && "$branch" != "develop" && "$branch" != "master" ]]; then
        # Extract the first line of the commit message
        first_line=$(head -n1 "$1")
        
        # Check if it's not a conventional commit or merge commit
        if [[ ! "$first_line" =~ ^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert) && ! "$first_line" =~ ^Merge ]]; then
            # Add branch prefix
            echo "$branch: $first_line" > "$1"
        fi
    fi
fi 